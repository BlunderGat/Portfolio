<!DOCTYPE html>
<html>
<head>
    <title>Сапер</title>
    <meta charset="utf-8">
</head>
<body>
    <div class="container">
        <div class="game-info">
            <div class="mines-counter">💣: <span id="mines-count">10</span></div>
            <button class="restart-btn" onclick="restartGame()">🔄</button>
            <div class="timer">⏱: <span id="time">0</span>s</div>
        </div>
        <div class="game">
        </div>
        <div class="message" id="message"></div>
    </div>
</body>
<script>
        const BOARD_SIZE = 10;
        const MINES_COUNT = 10;
        let board = [];
        let gameOver = false;
        let gameWon = false;
        let firstClick = true;
        let startTime = null;
        let timerInterval = null;
        let flagsPlaced = 0;
        let cellsRevealed = 0;

        // Инициализация игры
        function initGame() {
            clearInterval(timerInterval);
            document.getElementById('time').textContent = '0';
            document.getElementById('message').textContent = '';
            document.getElementById('message').className = 'message';

            gameOver = false;
            gameWon = false;
            firstClick = true;
            startTime = null;
            flagsPlaced = 0;
            cellsRevealed = 0;

            updateMinesCounter();
            createBoard();
            renderBoard();
        }

        // Создание игрового поля
        function createBoard() {
            board = [];
            for (let i = 0; i < BOARD_SIZE; i++) {
                board[i] = [];
                for (let j = 0; j < BOARD_SIZE; j++) {
                    board[i][j] = {
                        isMine: false,
                        isRevealed: false,
                        isFlagged: false,
                        neighborMines: 0,
                        row: i,
                        col: j
                    };
                }
            }
        }

        // Размещение мин после первого клика
        function placeMines(firstRow, firstCol) {
            let minesPlaced = 0;

            while (minesPlaced < MINES_COUNT) {
                const row = Math.floor(Math.random() * BOARD_SIZE);
                const col = Math.floor(Math.random() * BOARD_SIZE);

                // Не ставим мину на первую нажатую клетку и вокруг нее
                if (Math.abs(row - firstRow) <= 1 && Math.abs(col - firstCol) <= 1) {
                    continue;
                }

                if (!board[row][col].isMine) {
                    board[row][col].isMine = true;
                    minesPlaced++;

                    // Обновляем счетчики мин у соседних клеток
                    for (let i = Math.max(0, row - 1); i <= Math.min(BOARD_SIZE - 1, row + 1); i++) {
                        for (let j = Math.max(0, col - 1); j <= Math.min(BOARD_SIZE - 1, col + 1); j++) {
                            if (!(i === row && j === col)) {
                                board[i][j].neighborMines++;
                            }
                        }
                    }
                }
            }
        }

        // Отрисовка поля
        function renderBoard() {
            const gameElement = document.getElementsByClassName('game')[0];
            gameElement.innerHTML = '';

            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    const cell = board[i][j];
                    const cellElement = document.createElement('div');
                    cellElement.className = 'cell';
                    cellElement.dataset.row = i;
                    cellElement.dataset.col = j;

                    // Добавляем обработчики событий
                    cellElement.addEventListener('click', () => handleCellClick(i, j));
                    cellElement.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleRightClick(i, j);
                    });

                    // Отрисовываем содержимое клетки
                    if (cell.isRevealed) {
                        cellElement.classList.add('revealed');
                        if (cell.isMine) {
                            cellElement.classList.add('mine');
                            cellElement.textContent = '💥';
                        } else if (cell.neighborMines > 0) {
                            cellElement.textContent = cell.neighborMines;
                            cellElement.classList.add('neighbor-' + cell.neighborMines);
                        }
                    } else if (cell.isFlagged) {
                        cellElement.classList.add('flagged');
                        cellElement.textContent = '🚩';
                    }

                    gameElement.appendChild(cellElement);
                }
            }
        }

        // Обработка клика по клетке
        function handleCellClick(row, col) {
            if (gameOver || gameWon || board[row][col].isFlagged) return;

            // Запускаем таймер при первом клике
            if (firstClick) {
                firstClick = false;
                placeMines(row, col);
                startTimer();
            }

            const cell = board[row][col];

            // Если нажали на мину
            if (cell.isMine) {
                cell.isRevealed = true;
                gameOver = true;
                revealAllMines();
                showMessage('Вы проиграли!', 'lose');
                clearInterval(timerInterval);
                return;
            }

            // Раскрываем клетку
            revealCell(row, col);

            // Проверяем победу
            if (cellsRevealed === BOARD_SIZE * BOARD_SIZE - MINES_COUNT) {
                gameWon = true;
                showMessage('Вы выиграли!', 'win');
                clearInterval(timerInterval);
            }

            renderBoard();
        }

        // Раскрытие клетки (с рекурсией для пустых клеток)
        function revealCell(row, col) {
            if (row < 0 || row >= BOARD_SIZE || col < 0 || col >= BOARD_SIZE) return;

            const cell = board[row][col];
            if (cell.isRevealed || cell.isFlagged) return;

            cell.isRevealed = true;
            cellsRevealed++;

            // Если клетка пустая (нет мин вокруг), раскрываем соседей
            if (cell.neighborMines === 0) {
                for (let i = Math.max(0, row - 1); i <= Math.min(BOARD_SIZE - 1, row + 1); i++) {
                    for (let j = Math.max(0, col - 1); j <= Math.min(BOARD_SIZE - 1, col + 1); j++) {
                        if (!(i === row && j === col)) {
                            revealCell(i, j);
                        }
                    }
                }
            }
        }

        // Обработка правого клика (установка/снятие флажка)
        function handleRightClick(row, col) {
            if (gameOver || gameWon || board[row][col].isRevealed) return;

            const cell = board[row][col];
            cell.isFlagged = !cell.isFlagged;

            if (cell.isFlagged) {
                flagsPlaced++;
            } else {
                flagsPlaced--;
            }

            updateMinesCounter();
            renderBoard();
        }

        // Обновление счетчика мин
        function updateMinesCounter() {
            document.getElementById('mines-count').textContent = MINES_COUNT - flagsPlaced;
        }

        // Показать все мины при проигрыше
        function revealAllMines() {
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    if (board[i][j].isMine) {
                        board[i][j].isRevealed = true;
                    }
                }
            }
            renderBoard();
        }

        // Запуск таймера
        function startTimer() {
            startTime = new Date();
            timerInterval = setInterval(() => {
                const currentTime = new Date();
                const seconds = Math.floor((currentTime - startTime) / 1000);
                document.getElementById('time').textContent = seconds;
            }, 1000);
        }

        // Показать сообщение
        function showMessage(text, type) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = text;
            messageElement.classList.add(type);
        }

        // Перезапуск игры
        function restartGame() {
            initGame();
        }

        // Инициализация при загрузке
        window.onload = initGame;
</script>
<style>
    body, html {
        height: 100vh;
        padding: 0;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
    }

    .container {
        background-color: #2c3e50;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        text-align: center;
    }

    .game-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #34495e;
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        margin-bottom: 15px;
        font-size: 1.2em;
    }

    .restart-btn {
        background-color: #e74c3c;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 8px 15px;
        font-size: 1.2em;
        cursor: pointer;
        transition: background-color 0.3s;
    }

        .restart-btn:hover {
            background-color: #c0392b;
        }

    .game {
        display: grid;
        grid-template-columns: repeat(10, 30px);
        grid-template-rows: repeat(10, 30px);
        gap: 2px;
        margin-bottom: 15px;
        width: fit-content;
        height: fit-content;
        margin-left: auto;
        margin-right: auto;
    }

    .cell {
        width: 30px;
        height: 30px;
        background-color: #95a5a6;
        border-radius: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        cursor: pointer;
        user-select: none;
        transition: background-color 0.2s;
    }

        .cell:hover {
            background-color: #7f8c8d;
        }

        .cell.revealed {
            background-color: #ecf0f1;
            cursor: default;
        }

        .cell.mine {
            background-color: #e74c3c;
            color: white;
        }

        .cell.flagged {
            background-color: #3498db;
            color: white;
        }

        .cell.neighbor-1 {
            color: #2980b9;
        }

        .cell.neighbor-2 {
            color: #27ae60;
        }

        .cell.neighbor-3 {
            color: #c0392b;
        }

        .cell.neighbor-4 {
            color: #8e44ad;
        }

        .cell.neighbor-5 {
            color: #d35400;
        }

        .cell.neighbor-6 {
            color: #16a085;
        }

        .cell.neighbor-7 {
            color: #2c3e50;
        }

        .cell.neighbor-8 {
            color: #7f8c8d;
        }

    .message {
        padding: 10px;
        border-radius: 5px;
        font-weight: bold;
        font-size: 1.2em;
        min-height: 24px;
    }

        .message.win {
            background-color: #2ecc71;
            color: white;
        }

        .message.lose {
            background-color: #e74c3c;
            color: white;
        }
</style>
</html>